<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Dashboard - KP9 HR</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="header">
    <div style="flex:1"><strong style="color:var(--accent)">KP9 HR SYSTEM</strong></div>
    <div style="display:flex;gap:12px;align-items:center">
      <div class="small">Signed in as: {{ user.name }} ({{ user.role }})</div>
      <a href="/logout"><button class="button">Logout</button></a>
    </div>
  </div>

  <div class="container">
    <div class="sidebar">
      <div class="logo">KP9 HR SYSTEM</div>
      <div class="nav">
        <a class="active" href="/dashboard">Dashboard</a>
        <a href="/manage">Manage Users</a>
        <a href="/announcements">Announcements</a>
        <a href="/logs">Logs</a>
      </div>
      <div style="margin-top:18px" class="small">Logged in: {{ user.username }}</div>
    </div>

    <div class="main">
      <div class="toolbar">
        <h2 style="margin:0">Dashboard</h2>
      </div>

      <div class="grid">
        <div class="card">
          <h3>จำนวนพนักงาน</h3>
          <div style="font-size:28px;font-weight:700">{{ total_users }}</div>
          <div class="small">รวมตำแหน่งทั้งหมด</div>
        </div>

        <div class="card">
          <h3>ประกาศ</h3>
          <div style="font-size:28px;font-weight:700">{{ total_ann }}</div>
          <div class="small">ประกาศทั้งหมด</div>
        </div>

        <div class="card">
          <h3>Logs ล่าสุด</h3>
          {% for l in recent_logs %}
            <div class="small">{{ l.time }} — {{ l.actor }} - {{ l.action }} {{ l.target }}</div>
          {% endfor %}
        </div>
      </div>

      <div class="card">
        <h3>ทีมงาน</h3>
        <table class="table">
          <thead><tr><th>ชื่อ</th><th>ตำแหน่ง</th><th>ชื่อผู้ใช้</th><th>ดู</th></tr></thead>
          <tbody>
            {% for u in users %}
            <tr>
              <td>{{ u.name }}</td>
              <td><span class="badge {{ u.role.replace(' ', '') }}">{{ u.role }}</span></td>
              <td>{{ u.username }}</td>
              <td><a href="/profile/{{ u.username }}">ดูโปรไฟล์</a></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="card">
        <h3>ประกาศล่าสุด</h3>
        {% for a in announcements %}
          <div style="margin-bottom:10px">
            <strong>{{ a.title }}</strong>
            <div class="small">{{ a.time }} — โดย {{ a.author }}</div>
            <div style="margin-top:6px">{{ a.content }}</div>
          </div>
        {% endfor %}
      </div>

      <div class="footer">Copyright ©️ KP9COMMUNITY All Right to Service</div>
    </div>
  </div>
</body>
</html>
